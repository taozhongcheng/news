<link rel="stylesheet" href="__CSS__/category.css?v={$version}">
{include file="/pc/common/file" /}
{include file="/pc/common/header" /}
<div class="web__main">
  <div class="category__main web__content">
    <div class="category__main-content clearfix">
      <div class="category__main-l web__main-l">
        <fieldset style="border:none"></fieldset>
        <div class="category__main-new-list clearfix" id="LAY_demo1">
        </div>
      </div>
      {include file="/pc/common/aside" /}
    </div>
  </div>
</div>
{include file="/pc/common/footer" /}

<script language="javascript">
  layui.use('flow', function () {
    var flow = layui.flow;
    flow.load({
      elem: '#LAY_demo1', //流加载容器
      isLazyimg: true, // 图片懒加载
      done: function (page, next) { //执行下一页的回调
        let channel = "{$title}"
        if (channel === '推荐') channel = '';
        setTimeout(function () {
          var lis = [];
          $.get('{:url("/web/api/newsList")}', { page, channel }, function (data) {
            const list = data.data.list;
            layui.each(list, function (index, item) {
              let html = "<a href='/news/{$path}/" + item['id'] + ".html' class='category__main-new-list-item clearfix'>"
              html += "<div class='category__main-new-list-item-pc'><img lay-src=" + item['pic'] + " alt=''></div>"
              html += "<div class='category__main-new-list-item-text'>"
              html += "<div href='/news/{$path}/" + item['id'] + ".html' class='title'>" + item['title'] + "</div>"
              html += "<p>" + item['des'] + "</p>"
              html += "<div class='btns'>"
              html += "<span class='author'><i class='iconfont icon-author'></i>" + item['src'] + "</span>"
              if (channel) {
                html += "<span class='time'><i class='iconfont icon-time'></i>" + item['time'] + "</span>"
              } else {
                html += "<span class='channel'>" + item['channel'] + "</span>"
              }
              html += "</div></div></a>"
              lis.push(html)
            });
            next(lis.join(''), page < data.data.lastPage);
          })
        }, 500);
      }
    });
  });
</script>